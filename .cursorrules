# Project Configuration Rules

## Package Management
- Use pnpm exclusively for package management
- Node.js version: >= 18.0.0
- Keep pnpm-lock.yaml in version control

## Git Workflow
- Conventional commits required
- Pre-commit hooks must not be skipped
- All changes must be reviewed before staging
- Maximum commit message length: 100 characters

## Code Style
- TypeScript strict mode enabled
- ESLint configuration must be followed
- Tailwind CSS for styling
- Next.js 14+ conventions

## Development Practices
- Feature branches required
- Pull requests required for main branch
- Tests required for new features
- Documentation updates required for changes

## Project Structure
- /app - Next.js app router pages
- /components - React components
- /lib - Utility functions and shared code
- /hooks - Custom React hooks
- /public - Static assets

## Dependencies
- Next.js canary (15.2.0-canary.33)
- React 18+
- TypeScript 5+
- Tailwind CSS
- shadcn/ui components

## Subtitle File Structure
- Two VTT formats maintained:
  - Base format (s##e##.vtt)
  - Named format (s##e##-names.vtt)
- Base format characteristics:
  - More verbose with ~1800 lines per episode
  - Splits overlapping dialogue into separate timestamp blocks
  - Uses additional line breaks for readability
- Named format characteristics:
  - More compact with ~1700 lines per episode
  - Includes speaker labels (e.g., "MALCOLM:", "HUGH:")
  - Groups related dialogue under single timestamps
  - Combines overlapping dialogue under speaker labels
- Both formats must:
  - Use WebVTT standard formatting
  - Maintain identical timestamps
  - Preserve all dialogue content
  - Start with "WEBVTT" header

## Frame Extraction Structure
- Located in `/public/frames/{episodeId}/`
- Each timestamp has its own directory named by timestamp (e.g., "05-31-360" for "05:31.360")
- Each timestamp directory contains:
  - `frame-blank.jpg` - Original frame at exact timestamp
  - `frame-blank2.jpg` - Frame captured 1 second after timestamp
  - `speech.txt` - Plain text of the subtitles
- Frame characteristics:
  - Extracted using ffmpeg at exact timestamps from VTT
  - Second frame captured exactly 1 second after first frame
  - Both frames use identical scaling (500px width)
  - JPEG format for all images
- Processing:
  - Frames are only extracted once and cached
  - Both frames must exist for a timestamp to be considered complete
  - Speech text is always synchronized with VTT content

## Code Review Practices
- Always check both component definition AND usage
- Review state management in parent components
- Verify default values in both props and state initialization
- When fixing UI issues:
  - Check the entire component chain
  - Review state management at each level
  - Don't assume defaults are being used without verification
- Document findings and learnings for team reference 

## Next.js Route Handlers

1. **Route Parameters**
   - Route params are always a Promise
   - Correct type: `{ params: Promise<{ paramName: string }> }`
   - Must await params before use:
   ```typescript
   export async function GET(
     request: NextRequest,
     { params }: { params: Promise<{ paramName: string }> }
   ) {
     const resolvedParams = await params;
     // Use resolvedParams.paramName
   }
   ``` 
# Project Configuration Rules

## Package Management
- Use pnpm exclusively for package management
- Node.js version: >= 18.0.0
- Keep pnpm-lock.yaml in version control

## Git Workflow
- Conventional commits required
- Pre-commit hooks must not be skipped
- All changes must be reviewed before staging
- Maximum commit message length: 100 characters

## Code Style
- TypeScript strict mode enabled
- ESLint configuration must be followed
- Tailwind CSS for styling
- Next.js 14+ conventions

## Development Practices
- Feature branches required
- Pull requests required for main branch
- Tests required for new features
- Documentation updates required for changes

## Project Structure
- /app - Next.js app router pages
- /components - React components
- /lib - Utility functions and shared code
- /hooks - Custom React hooks
- /public - Static assets

## Dependencies
- Next.js 14+
- React 18+
- TypeScript 5+
- Tailwind CSS
- shadcn/ui components

## Subtitle File Structure
- Two VTT formats maintained:
  - Base format (s##e##.vtt)
  - Named format (s##e##-names.vtt)
- Base format characteristics:
  - More verbose with ~1800 lines per episode
  - Splits overlapping dialogue into separate timestamp blocks
  - Uses additional line breaks for readability
- Named format characteristics:
  - More compact with ~1700 lines per episode
  - Includes speaker labels (e.g., "MALCOLM:", "HUGH:")
  - Groups related dialogue under single timestamps
  - Combines overlapping dialogue under speaker labels
- Both formats must:
  - Use WebVTT standard formatting
  - Maintain identical timestamps
  - Preserve all dialogue content
  - Start with "WEBVTT" header

## Frame Extraction Structure
- Located in `/public/frames/{episodeId}/`
- Each timestamp has its own directory named by timestamp (e.g., "05-31-360" for "05:31.360")
- Each timestamp directory contains:
  - `frame-blank.jpg` - Original frame without subtitles
  - `frame.jpg` - Frame with subtitles overlaid
  - `speech.txt` - Plain text of the subtitles
- Frame characteristics:
  - Extracted using ffmpeg at exact timestamps from VTT
  - JPEG format for all images
  - Subtitles use white text with black outline
  - Text positioned at bottom center of frame
- Processing:
  - Frames are only extracted once and cached
  - Subtitle overlay is regenerated if needed
  - Speech text is always synchronized with VTT content 